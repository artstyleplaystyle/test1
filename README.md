# Coffee Feed — бесконечная лента карточек кофе

Интерактивная лента карточек с сортами кофе, с серверным кешированием и устойчивыми запросами ко внешним источникам. Проект выполнен на SvelteKit + TypeScript + PostCSS. Поддерживает touch и desktop, скелетоны, автодогрузку при бездействии и логи серверной части.

## Демо
- Продакшн: https://test1-beta-green.vercel.app/

## Основные фичи
- SSR: первая карточка приходит с сервера.
- Серверный кеш: последняя карточка хранится в памяти процесса и в файлах `.server-cache/last_card.{type}.json`; при повторных открытиях используется кеш без запросов во внешние источники.
- Добавление по кнопке: блокировка кнопки во время загрузки + скелетон.
- Автодогрузка: если 30 секунд нет действий — автоматически подгружается ещё одна карточка каждые 30 сек.
- Надёжность: дедупликация параллельных запросов, ретраи с экспоненциальной задержкой, таймауты, логирование.
- UX: плейсхолдер для картинок, плавная анимация, горизонтальный скролл тегов `ingredients` на touch/desktop.

## Стек
- SvelteKit ^2, Svelte ^4
- TypeScript ^5
- PostCSS (autoprefixer, nesting)
- Playwright для E2E

## Установка и запуск локально
```bash
npm i
npm run dev       # http://localhost:5173 (HMR)
npm run build     # продакшн-сборка
npm run preview   # локальный сервер продакшн-сборки
npm run test:e2e  # e2e тесты (Playwright)
```

## API
- `GET /api/initial?type=hot|iced` — вернуть стартовую карточку (из кеша, либо загрузить и закешировать).
- `POST /api/next?type=hot|iced` — вернуть следующую карточку и закешировать как последнюю.

Ответ имеет форму:
```json
{
  "id": 123,
  "title": "...",
  "description": "...",
  "ingredients": ["..."],
  "image": "https://..."
}
```

## Кеширование
- В памяти процесса (LRU) — быстрый путь.
- Persist в файловой системе: `.server-cache/last_card.hot.json` и `.server-cache/last_card.iced.json`.перезапусками. 



### Замечания по продакшену
- Без Vercel KV сервер может терять кеш между рестартами (например, при ребалансе). Подключение KV решает этот кейс.
- Источники данных: `api.sampleapis.com`. При сетевых сбоях срабатывают ретраи и таймауты.

## Тестирование
- Локально: `npm run test:e2e` (Playwright скачает браузеры при первом запуске).
- Можно запускать E2E в CI перед деплоем.

## Лицензия
MIT (или укажите иную, если требуется)
